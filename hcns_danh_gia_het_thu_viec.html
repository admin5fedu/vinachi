<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phiếu Đánh Giá Hết Thử Việc</title>
    <!-- Thư viện Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Thư viện để chuyển HTML sang Canvas/Hình ảnh -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- Thư viện để tạo file PDF từ Canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        /* Cài đặt cơ bản cho A4 */
        @page {
            size: A4;
            margin: 1cm;
        }
        
        body {
            /* Đã cập nhật font chữ thành Times New Roman */
            font-family: 'Times New Roman', serif;
            background-color: #ffffff;
            /* Đã tăng cỡ chữ cơ bản lên 1px */
            font-size: 11px;
            line-height: 1.2;
            color: #000;
            margin: 0;
            padding: 0;
        }
        
        .form-container {
            width: 21cm;
            min-height: 29.7cm;
            max-width: 21cm;
            margin: 0 auto;
            padding: 1cm;
            background-color: #ffffff;
            box-sizing: border-box;
        }
        
        .section-title {
            /* Đã tăng cỡ chữ lên 1px */
            font-size: 13px;
            font-weight: 600;
            color: #1f2937;
            margin: 8px 0 4px 0;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 2px;
        }
        
        .subsection-title {
            /* Đã tăng cỡ chữ lên 1px */
            font-size: 12px;
            font-weight: 600;
            color: #374151;
            margin: 6px 0 3px 0;
        }
        
        .label {
            font-weight: 500;
            color: #4b5563;
            margin-bottom: 2px;
            display: block;
            /* Đã tăng cỡ chữ lên 1px */
            font-size: 10px;
        }
        
        .static-data {
            padding: 2px 4px;
            width: 100%;
            background-color: #f9fafb;
            border: 1px solid #d1d5db;
            border-radius: 2px;
            display: block;
            min-height: 16px;
            white-space: pre-wrap;
            /* Đã tăng cỡ chữ lên 1px */
            font-size: 10px;
            line-height: 1.3;
        }
        
        .static-textarea {
            padding: 3px 4px;
            width: 100%;
            background-color: #f9fafb;
            border: 1px solid #d1d5db;
            border-radius: 2px;
            display: block;
            min-height: 24px;
            white-space: pre-wrap;
            /* Đã tăng cỡ chữ lên 1px */
            font-size: 10px;
            line-height: 1.3;
        }
        
        .company-header {
            margin-bottom: 8px;
        }
        
        .company-logo {
            width: 50px;
            height: 50px;
            object-fit: contain; 
            border-radius: 0; 
        }
        
        .company-name {
            /* Đã tăng cỡ chữ lên 1px */
            font-size: 15px;
            font-weight: 700;
            color: #1f2937;
            margin: 0;
        }
        
        .company-address {
            /* Đã tăng cỡ chữ lên 1px */
            font-size: 10px;
            color: #6b7280;
            font-style: italic;
            margin: 2px 0 0 0;
        }
        
        .form-title {
            text-align: center;
            margin: 6px 0;
        }
        
        .form-title h1 {
            /* Đã tăng cỡ chữ lên 1px */
            font-size: 18px;
            font-weight: 700;
            color: #1f2937;
            margin: 0 0 4px 0;
        }
        
        .form-code {
            /* Đã tăng cỡ chữ lên 1px */
            font-size: 11px;
            color: #6b7280;
            margin: 0;
        }
        
        /* Bảng thông tin */
        .info-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 6px;
        }
        
        .info-table td {
            padding: 2px 4px;
            vertical-align: top;
            /* Đã tăng cỡ chữ lên 1px */
            font-size: 10px;
        }
        
        .info-table .label-cell {
            font-weight: 500;
            color: #374151;
            width: 20%;
        }
        
        .info-table .data-cell {
            width: 30%;
        }
        
        /* Bảng đánh giá */
        .evaluation-table {
            width: 100%;
            border-collapse: collapse;
            margin: 4px 0;
        }
        
        .evaluation-table th,
        .evaluation-table td {
            border: 1px solid #d1d5db;
            padding: 3px;
            /* Đã tăng cỡ chữ lên 1px */
            font-size: 10px;
            vertical-align: top;
        }
        
        .evaluation-table th {
            background-color: #f3f4f6;
            font-weight: 600;
            color: #000;
            text-align: center;
        }
        
        /* Grid layout cho đánh giá */
        .evaluation-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin: 4px 0;
        }
        
        .evaluation-card {
            border: 1px solid #d1d5db;
            border-radius: 4px;
            padding: 6px;
        }
        
        .evaluation-card .card-title {
            /* Đã tăng cỡ chữ lên 1px */
            font-size: 11px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 4px;
        }
        
        /* Phần chữ ký */
        .signature-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 8px;
            text-align: center;
        }
        
        .signature-item {
            display: flex;
            flex-direction: column;
        }
        
        .signature-title {
            /* Đã tăng cỡ chữ lên 1px */
            font-size: 11px;
            font-weight: 600;
            margin-bottom: 2px;
        }
        
        .signature-subtitle {
            /* Đã tăng cỡ chữ lên 1px */
            font-size: 9px;
            color: #6b7280;
            font-style: italic;
            margin-bottom: 8px;
        }
        
        .signature-line {
            border-bottom: 1px solid #374151;
            height: 20px;
            margin: 0 10px;
        }
        
        .opinion-label {
            /* Đã tăng cỡ chữ lên 1px */
            font-size: 10px;
            font-weight: 500;
            margin: 4px 0 2px 0;
        }
        
        .opinion-area {
            border-bottom: 1px solid #374151;
            height: 30px;
            margin: 0 5px;
        }
        
        /* Responsive cho màn hình nhỏ */
        @media screen and (max-width: 768px) {
            .form-container {
                width: 100%;
                padding: 10px;
            }
            
            .evaluation-grid {
                grid-template-columns: 1fr;
            }
            
            .signature-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }
        
        /* CSS cho in ấn - đảm bảo giống hệt hiển thị màn hình */
        @media print {
            * {
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
                print-color-adjust: exact !important;
                color: #000 !important; /* Đảm bảo tất cả chữ đều là màu đen khi in */
            }
            
            body {
                margin: 0 !important;
                padding: 0 !important;
                background: white !important;
                /* Đã tăng cỡ chữ để in rõ hơn */
                font-size: 11px !important;
                line-height: 1.2 !important;
            }
            
            .form-container {
                width: 100% !important;
                max-width: none !important;
                margin: 0 !important;
                padding: 1cm !important;
                box-shadow: none !important;
                page-break-inside: avoid;
            }
            
            .section-title {
                page-break-after: avoid;
            }
            
            .evaluation-grid {
                page-break-inside: avoid;
            }
            
            .signature-grid {
                page-break-inside: avoid;
            }
            
            /* Đảm bảo màu nền được in */
            .static-data,
            .static-textarea {
                background-color: #f9fafb !important;
                border: 1px solid #d1d5db !important;
            }
            
            .evaluation-table th {
                background-color: #f3f4f6 !important;
            }
            
            /* Ẩn nút tải xuống khi in */
            .no-print {
                display: none !important;
            }
        }
    </style>
</head>
<body>
<div class="flex justify-end p-4">
    <!-- Nút Tải xuống PDF, sẽ bị bỏ qua khi chuyển đổi sang PDF -->
    <button id="downloadPdfButton" 
            class="no-print bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"
            data-html2canvas-ignore="true" onclick="downloadPDF()">
        Tải xuống PDF
    </button>
</div>

<div class="form-container" id="formContainer">
    <!-- Header công ty -->
    <div class="company-header">
        <table style="width: 100%; border-collapse: collapse;">
            <tr>
                <td style="width: 60px; vertical-align: middle;">
                    <img src="https://drive.google.com/thumbnail?id=12VL0Dxkj5d8xwLFVRslpHdtlWd4MHF5a" 
                            alt="Company Logo" class="company-logo">
                </td>
                <td style="vertical-align: middle; padding-left: 10px;">
                    <p class="company-name">CÔNG TY TNHH VINACHI VIỆT NAM</p>
                    <p class="company-address">Địa chỉ: Kim Thiều - Hương Mạc - Từ Sơn - Bắc Ninh</p>
                </td>
            </tr>
        </table>
    </div>

    <!-- Tiêu đề form -->
    <div class="form-title">
        <h1>PHIẾU ĐÁNH GIÁ HẾT THỬ VIỆC</h1>
        <p class="form-code">Mã phiếu: <span id="maPhieu"></span></p>
    </div>

    <!-- I. Thông tin chung -->
    <div class="section-title">I. Thông tin chung</div>
    <table class="info-table">
        <tr>
            <td class="label-cell">Nhân viên:</td>
            <td class="data-cell"><span class="static-data" id="nhanVien"></span></td>
            <td class="label-cell">Phòng:</td>
            <td class="data-cell"><span class="static-data" id="phong"></span></td>
        </tr>
        <tr>
            <td class="label-cell">Vị trí:</td>
            <td class="data-cell"><span class="static-data" id="viTri"></span></td>
            <td class="label-cell">Ngày thử việc:</td>
            <td class="data-cell"><span class="static-data" id="ngayThuViec"></span></td>
        </tr>
        <tr>
            <td class="label-cell">Ngày hết thử việc:</td>
            <td class="data-cell"><span class="static-data" id="ngayHetThuViec"></span></td>
            <td class="label-cell">Ngày đánh giá:</td>
            <td class="data-cell"><span class="static-data" id="ngayDanhGia"></span></td>
        </tr>
    </table>

    <!-- II. Đánh giá chi tiết -->
    <div class="section-title">II. Đánh giá chi tiết</div>
    <div class="subsection-title">A. Kết quả công việc</div>
    <table class="evaluation-table">
        <thead>
            <tr>
                <th style="width: 35%;">Tên công việc</th>
                <th style="width: 20%;">Mức độ hoàn thành</th>
                <th style="width: 45%;">Nhận xét</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><span class="static-data" id="tenCongViec_1"></span></td>
                <td style="text-align: center;"><span class="static-data" id="hoanThanh_1"></span></td>
                <td><span class="static-data" id="nhanXet_1"></span></td>
            </tr>
            <tr>
                <td><span class="static-data" id="tenCongViec_2"></span></td>
                <td style="text-align: center;"><span class="static-data" id="hoanThanh_2"></span></td>
                <td><span class="static-data" id="nhanXet_2"></span></td>
            </tr>
            <tr>
                <td><span class="static-data" id="tenCongViec_3"></span></td>
                <td style="text-align: center;"><span class="static-data" id="hoanThanh_3"></span></td>
                <td><span class="static-data" id="nhanXet_3"></span></td>
            </tr>
            <tr>
                <td><span class="static-data" id="tenCongViec_4"></span></td>
                <td style="text-align: center;"><span class="static-data" id="hoanThanh_4"></span></td>
                <td><span class="static-data" id="nhanXet_4"></span></td>
            </tr>
            <tr>
                <td><span class="static-data" id="tenCongViec_5"></span></td>
                <td style="text-align: center;"><span class="static-data" id="hoanThanh_5"></span></td>
                <td><span class="static-data" id="nhanXet_5"></span></td>
            </tr>
        </tbody>
    </table>

    <!-- B. Thái độ - Kiến thức - Kỹ năng -->
    <div class="subsection-title">B. Thái độ - Kiến thức - Kỹ năng</div>
    <div class="evaluation-grid">
        <div class="evaluation-card">
            <div class="card-title">Thái độ - Tinh thần</div>
            <div>
                <span class="label">Đánh giá chung:</span>
                <span class="static-data" id="tt_danhgia"></span>
            </div>
            <div style="margin-top: 3px;">
                <span class="label">Nhận xét:</span>
                <span class="static-textarea" id="tt_nhanxet"></span>
            </div>
        </div>
        
        <div class="evaluation-card">
            <div class="card-title">Kiến thức - Hiểu biết</div>
            <div>
                <span class="label">Đánh giá chung:</span>
                <span class="static-data" id="kt_danhgia"></span>
            </div>
            <div style="margin-top: 3px;">
                <span class="label">Nhận xét:</span>
                <span class="static-textarea" id="kt_nhanxet"></span>
            </div>
        </div>

        <div class="evaluation-card">
            <div class="card-title">Kỹ năng</div>
            <div>
                <span class="label">Đánh giá chung:</span>
                <span class="static-data" id="kn_danhgia"></span>
            </div>
            <div style="margin-top: 3px;">
                <span class="label">Nhận xét:</span>
                <span class="static-textarea" id="kn_nhanxet"></span>
            </div>
        </div>
    </div>

    <!-- III. Đánh giá tổng thể và Kết luận -->
    <div class="section-title">III. Đánh giá tổng thể và Kết luận</div>
    <div class="subsection-title">A. Đánh giá tổng thể</div>
    <div class="evaluation-grid">
        <div>
            <span class="label">Điểm mạnh:</span>
            <span class="static-data" id="diemManh"></span>
        </div>
        <div>
            <span class="label">Điểm yếu:</span>
            <span class="static-data" id="diemYeu"></span>
        </div>
        <div>
            <span class="label">Đánh giá khác:</span>
            <span class="static-data" id="danhGiaKhac"></span>
        </div>
    </div>

    <!-- B. Kết luận -->
    <div class="subsection-title">B. Kết luận</div>
    <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 8px;">
        <div>
            <span class="label">Kết luận:</span>
            <span class="static-data" id="ketLuan"></span>
        </div>
        <div>
            <span class="label">Kết luận khác:</span>
            <span class="static-data" id="ketLuanKhac"></span>
        </div>
    </div>

    <!-- IV. Xác nhận của các bên -->
    <div class="section-title">IV. Xác nhận của các bên</div>
    <div class="signature-grid">
        <div class="signature-item">
            <div class="signature-title">Quản lý trực tiếp</div>
            <div class="signature-subtitle">(Ký, ghi rõ họ tên)</div>
            <div class="signature-line"></div>
            <div class="opinion-label">Ý kiến:</div>
            <div class="opinion-area"></div>
        </div>
        
        <div class="signature-item">
            <div class="signature-title">HCNS</div>
            <div class="signature-subtitle">(Ký, ghi rõ họ tên)</div>
            <div class="signature-line"></div>
            <div class="opinion-label">Ý kiến:</div>
            <div class="opinion-area"></div>
        </div>
        
        <div class="signature-card">
            <div class="signature-title">Ban Giám Đốc</div>
            <div class="signature-subtitle">(Ký, ghi rõ họ tên)</div>
            <div class="signature-line"></div>
            <div class="opinion-label">Ý kiến:</div>
            <div class="opinion-area"></div>
        </div>
    </div>
</div>

<script>
    // Hàm này sẽ lấy dữ liệu từ URL và hiển thị lên form
    document.addEventListener('DOMContentLoaded', () => {
        const params = new URLSearchParams(window.location.search);

        function updateElementText(id, paramName) {
            const element = document.getElementById(id);
            if (element && params.has(paramName)) {
                // Xử lý xuống dòng: thay thế \n thành ký tự xuống dòng thực
                const text = decodeURIComponent(params.get(paramName)).replace(/\\n/g, '\n');
                element.textContent = text;
            }
        }

        // Thông tin chung
        updateElementText('maPhieu', 'maPhieu');
        // Đã sửa 'maNhanVienHoTen' thành 'nhanVien' để khớp với ID trong HTML
        updateElementText('nhanVien', 'maNhanVienHoTen'); 
        updateElementText('phong', 'phong');
        updateElementText('viTri', 'viTri');
        updateElementText('ngayThuViec', 'ngayThuViec');
        updateElementText('ngayHetThuViec', 'ngayHetThuViec');
        updateElementText('ngayDanhGia', 'ngayDanhGia');

        // Kết quả công việc
        for (let i = 1; i <= 5; i++) {
            updateElementText(`tenCongViec_${i}`, `tenCongViec_${i}`);
            updateElementText(`hoanThanh_${i}`, `hoanThanh_${i}`);
            updateElementText(`nhanXet_${i}`, `nhanXet_${i}`);
        }

        // Các mục đánh giá khác
        updateElementText('tt_danhgia', 'tt_danhgia');
        updateElementText('tt_nhanxet', 'tt_nhanxet');
        updateElementText('kt_danhgia', 'kt_danhgia');
        updateElementText('kt_nhanxet', 'kt_nhanxet');
        updateElementText('kn_danhgia', 'kn_danhgia');
        updateElementText('kn_nhanxet', 'kn_nhanxet');
        updateElementText('diemManh', 'diemManh');
        updateElementText('diemYeu', 'diemYeu');
        updateElementText('danhGiaKhac', 'danhGiaKhac');
        updateElementText('ketLuan', 'ketLuan');
        updateElementText('ketLuanKhac', 'ketLuanKhac');
    });

    // Hàm chuyển đổi HTML sang PDF
    async function downloadPDF() {
        // Lấy nội dung form
        const element = document.getElementById('formContainer');

        // Tạo canvas từ HTML
        const canvas = await html2canvas(element, {
            scale: 2, // Tăng độ phân giải để chất lượng tốt hơn
            useCORS: true, // Cho phép tải ảnh từ CDN
        });
        
        // Kích thước trang A4
        const A4_WIDTH = 210; // mm
        const imgData = canvas.toDataURL('image/jpeg', 1.0);
        
        // Tạo instance jsPDF với định dạng A4
        const doc = new jspdf.jsPDF({
            orientation: 'portrait',
            unit: 'mm',
            format: 'a4',
        });
        
        // Tính toán kích thước ảnh để vừa trang
        const imgProps = doc.getImageProperties(imgData);
        const imgWidth = A4_WIDTH;
        const imgHeight = (imgProps.height * imgWidth) / imgProps.width;
        
        // Đặt lề để trông đẹp hơn
        const margin = 10;
        const finalImgWidth = A4_WIDTH - 2 * margin;
        const finalImgHeight = (imgProps.height * finalImgWidth) / imgProps.width;

        // Thêm ảnh vào PDF. Nó sẽ tự động co dãn để vừa 1 trang
        doc.addImage(imgData, 'JPEG', margin, margin, finalImgWidth, finalImgHeight);

        // Lưu file PDF
        doc.save('Phieu_danh_gia_het_thu_viec.pdf');
    }
</script>

</body>
</html>
