<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thư mời phỏng vấn</title>
    <!-- Thư viện Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Thư viện để chuyển HTML sang Canvas/Hình ảnh -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- Thư viện để tạo file PDF từ Canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        /* Cài đặt cho in ấn: Khổ giấy A4 và lề 1.5cm */
        @page {
            size: A4;
            margin: 1.5cm;
        }

        body {
            font-family: 'Times New Roman', Times, serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            color: #333;
            background-color: #f0f0f0;
            font-size: 11pt;
        }

        .document-container {
            width: 21cm;
            min-height: 29.7cm;
            max-width: 21cm;
            margin: 30px auto;
            padding: 1.5cm;
            background-color: #fff;
            box-sizing: content-box;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .header-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .header-table td {
            vertical-align: top;
            padding: 0;
        }

        .header-table .company-info {
            text-align: left;
        }

        .company-info h2 {
            margin: 0;
            font-size: 14px;
            line-height: 1.2;
            color: #555;
            font-weight: bold;
        }

        .company-info .address {
            font-style: italic;
            margin: 0;
            font-size: 12px;
            line-height: 1.2;
        }

        .location {
            font-style: italic;
            text-align: right;
            margin-bottom: 15px;
            font-size: 12px;
        }

        .section-title {
            font-weight: bold;
            font-size: 16px;
            text-align: center;
            margin-bottom: 15px;
            text-transform: uppercase;
        }

        .content {
            margin-bottom: 20px;
            font-size: 13px;
        }

        .content p {
            margin: 5px 0;
        }

        .details ul {
            list-style-type: none;
            padding: 0;
        }

        .details li {
            margin-bottom: 5px;
        }
        
        .contact-info {
            text-align: justify;
            margin-top: 20px;
            font-size: 13px;
        }

        .footer p {
            font-size: 13px;
            margin-top: 10px;
        }

        .signature-wrapper {
            margin-top: 30px;
        }

        .signature {
            text-align: right;
            margin-top: 50px;
            font-size: 13px;
        }

        /* Ẩn nút "Xuất PDF" khi in */
        .no-print {
            display: block;
        }

        /* CSS cho in ấn - đảm bảo giống hệt hiển thị màn hình */
        @media print {
            * {
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
                print-color-adjust: exact !important;
                color: #000 !important;
                font-family: 'Times New Roman', Times, serif !important;
                background: white !important;
            }

            body {
                margin: 0 !important;
                padding: 0 !important;
                background: white !important;
            }

            .document-container {
                width: 100% !important;
                min-height: 29.7cm !important;
                max-width: none !important;
                margin: 0 !important;
                padding: 1.5cm !important;
                box-shadow: none !important;
                border: none !important;
                box-sizing: content-box;
            }

            .no-print {
                display: none !important;
            }
        }
    </style>
</head>
<body>

<div class="flex justify-end p-4 no-print">
    <!-- Nút "Xuất PDF" -->
    <button id="downloadPdfButton" 
            class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"
            data-html2canvas-ignore="true" onclick="downloadPDF()">
        Xuất PDF
    </button>
</div>

<div class="document-container" id="documentContainer">
    <!-- Header Section as a table -->
    <table class="header-table">
        <tr>
            <td style="width: 20%;">
                <!-- Logo -->
                <img src="https://drive.google.com/thumbnail?id=12VL0Dxkj5d8xwLFVRslpHdtlWd4MHF5a" alt="VINACHI Logo" style="max-width: 100px; height: auto;">
            </td>
            <td class="company-info" style="width: 80%;">
                <h2>CÔNG TY TNHH VINACHI VIỆT NAM</h2>
                <p class="address">Kim Thiều - Hương Mạc - Từ Sơn - Bắc Ninh</p>
            </td>
        </tr>
    </table>
    
    <div class="location">
        <p>Vinachi, <span id="ngay_thang"></span></p>
    </div>

    <div class="section-title">
        THƯ MỜI THAM DỰ PHỎNG VẤN
    </div>

    <div class="content">
        <p><strong>Thân gửi:</strong> <span id="ungvien_data"></span></p>
        <p>Công ty Vinachi trân trọng thông báo CV của bạn đã có đánh giá phù hợp trong quá trình xem xét hồ sơ ứng tuyển. Công ty trân trọng kính mời anh (chị) đến tham gia phỏng vấn tại công ty chúng tôi với nội dung như sau:</p>
        <div class="details">
            <ul>
                <li>o <strong>Vị trí ứng tuyển:</strong> <span id="vitriungtuyen_data"></span></li>
                <li>o <strong>Vị trí khác:</strong> <span id="vitrikhac_data"></span></li>
                <li>o <strong>Thời gian:</strong> <span id="thoigian_data"></span></li>
                <li>o <strong>Địa điểm:</strong> <span id="diadiem_data"></span></li>
                <li>o <strong>Nơi phỏng vấn:</strong> <span id="noiphongvan_data"></span></li>
            </ul>
        </div>
        <p class="contact-info">Mọi chi tiết xin liên hệ P.HCNS Vinachi <strong id="sdt_data"></strong> <strong id="email_data"></strong>. Rất mong anh (chị) thu xếp thời gian tham gia. Trường hợp anh (chị) không thu xếp được thời gian, xin vui lòng liên hệ lại với chúng tôi theo số điện thoại và địa chỉ như trên để xác nhận lại.</p>
    </div>
    
    <div class="footer">
        <p>Trân trọng kính mời!</p>
    </div>
    
    <div class="signature-wrapper">
        <div class="signature">
            <p><strong>TM BAN GIÁM ĐỐC</strong></p>
            <p><strong>PHÒNG HÀNH CHÍNH NHÂN SỰ</strong></p>
        </div>
    </div>

</div>

<script>
    // Hàm này sẽ lấy dữ liệu từ URL và hiển thị lên form
    document.addEventListener('DOMContentLoaded', () => {
        const params = new URLSearchParams(window.location.search);

        function updateElementText(id, paramName) {
            const element = document.getElementById(id);
            if (element && params.has(paramName)) {
                const text = decodeURIComponent(params.get(paramName)).replace(/\\n/g, '\n');
                element.textContent = text;
            }
        }
        
        // Cập nhật các trường thông tin
        // Vui lòng sử dụng các tên biến dưới đây khi truyền dữ liệu qua URL
        updateElementText('ngay_thang', 'Ngay');
        updateElementText('ungvien_data', 'Than_gui');
        updateElementText('vitriungtuyen_data', 'Vi_tri_ung_tuyen');
        updateElementText('vitrikhac_data', 'Vi_tri_khac');
        updateElementText('thoigian_data', 'Thoi_gian');
        updateElementText('diadiem_data', 'Dia_diem');
        updateElementText('noiphongvan_data', 'Noi_phong_van');
        updateElementText('sdt_data', 'sdt');
        updateElementText('email_data', 'email');
    });

    // Hàm chuyển đổi HTML sang PDF
    async function downloadPDF() {
        const element = document.getElementById('documentContainer');
        
        // Tạo canvas từ HTML
        const canvas = await html2canvas(element, {
            scale: 2, 
            useCORS: true,
        });

        // Kích thước trang A4
        const A4_WIDTH = 210; // mm
        const A4_HEIGHT = 297; // mm
        const margin = 15; // 1.5cm
        const imgData = canvas.toDataURL('image/jpeg', 1.0);
        
        // Tạo instance jsPDF với định dạng A4
        const doc = new jspdf.jsPDF({
            orientation: 'portrait',
            unit: 'mm',
            format: 'a4',
        });
        
        // Tính toán kích thước ảnh để vừa với lề 1.5cm
        const imgProps = doc.getImageProperties(imgData);
        const finalImgWidth = A4_WIDTH - 2 * margin;
        const finalImgHeight = (imgProps.height * finalImgWidth) / imgProps.width;

        // Thêm ảnh vào PDF
        doc.addImage(imgData, 'JPEG', margin, (A4_HEIGHT - finalImgHeight) / 2, finalImgWidth, finalImgHeight);

        // Lưu file PDF
        doc.save('Thu_moi_phong_van.pdf');
    }
</script>

</body>
</html>
