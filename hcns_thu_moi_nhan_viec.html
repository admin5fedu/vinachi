<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thư mời nhận việc</title>
    <!-- Thư viện Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Thư viện để chuyển HTML sang Canvas/Hình ảnh -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- Thư viện để tạo file PDF từ Canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: 'Times New Roman', Times, serif;
            line-height: 1.4;
            margin: 0;
            padding: 0;
            color: #333;
            background-color: #f0f0f0;
            font-size: 11pt;
        }

        .document-container {
            width: 21cm;
            padding: 1.5cm; /* Lề đồng bộ 1.5cm */
            margin: 30px auto;
            background-color: #fff;
            box-sizing: border-box;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        /* Các lớp CSS cho header */
        .header-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .header-table td {
            vertical-align: top;
            padding: 0;
        }

        .header-table .company-info {
            text-align: left;
        }

        .company-info h2 {
            margin: 0;
            font-size: 16px;
            line-height: 1.2;
            color: #555;
            font-weight: bold;
        }

        .company-info .address {
            font-style: italic;
            margin: 0;
            font-size: 14px;
            line-height: 1.2;
        }

        @page {
            size: A4;
            margin: 1.5cm; /* Lề đồng bộ 1.5cm khi in */
        }

        @media print {
            .document-container {
                width: 100% !important;
                max-width: none !important;
                margin: 0 !important;
                padding: 1.5cm;
                box-shadow: none !important;
                border: none !important;
            }
            body {
                margin: 0 !important;
                padding: 0 !important;
                background: white !important;
            }
            .no-print {
                display: none !important;
            }
            * {
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
                print-color-adjust: exact !important;
                color: #000 !important;
                font-family: 'Times New Roman', Times, serif !important;
                background: white !important;
            }
        }

        .section-title {
            font-weight: bold;
            font-size: 20px;
            text-align: center;
            margin-bottom: 30px;
        }

        .section-heading {
            font-weight: bold;
            text-transform: uppercase;
            margin-top: 20px;
            margin-bottom: 10px;
        }
        
        .list-style-none {
            list-style-type: none;
            padding-left: 0;
        }
        
        .indent-1 {
            padding-left: 20px;
        }

    </style>
</head>
<body>

<div class="flex justify-end p-4 no-print">
    <button id="downloadPdfButton"
            class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"
            data-html2canvas-ignore="true" onclick="downloadPDF()">
        Xuất PDF
    </button>
</div>

<div class="document-container" id="documentContainer">
    <!-- Header Section -->
    <table class="header-table">
        <tr>
            <td style="width: 20%;">
                <img src="https://drive.google.com/thumbnail?id=12VL0Dxkj5d8xwLFVRslpHdtlWd4MHF5a" alt="VINACHI Logo" style="max-width: 100px; height: auto;">
            </td>
            <td class="company-info" style="width: 80%;">
                <h2>CÔNG TY TNHH VINACHI VIỆT NAM</h2>
                <p class="address">Kim Thiều - Hương Mạc - Từ Sơn - Bắc Ninh</p>
            </td>
        </tr>
    </table>
    
    <div class="location-date text-right mb-8">
        Bắc Ninh, ngày <span id="ngay_data"></span> tháng <span id="thang_data"></span> năm <span id="nam_data"></span>
    </div>

    <div class="section-title">THƯ MỜI NHẬN VIỆC</div>
    
    <p class="mb-4">
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        Công ty TNHH Vinachi Việt Nam gửi đến Anh/chị <span id="ten_ung_vien_data" class="font-bold uppercase"></span> thư mời hợp tác với nội dung như sau:
    </p>

    <h3 class="section-heading">I - THỜI GIAN VÀ ĐỊA ĐIỂM</h3>
    <ul class="list-style-none">
        <li class="mb-2">
            - Lúc: <span id="gio_data"></span>h<span id="phut_data"></span> ngày <span id="ngay_nhan_viec_data"></span> tháng <span id="thang_nhan_viec_data"></span> năm <span id="nam_nhan_viec_data"></span> Tại: <span id="dia_diem_data"></span>
        </li>
        <li class="mb-2">
            - Vị trí công việc: <span id="vi_tri_ung_tuyen_data"></span> thuộc phòng <span id="phong_ban_data"></span>
        </li>
        <li class="mb-2">
            - Thời gian làm việc: <span id="thoi_gian_lam_viec_data"></span>.
        </li>
        <li class="mb-2">
            - Thời gian thử việc: <span id="thoi_gian_thu_viec_info"></span>
        </li>
        <li class="mb-2" id="tg_tv_li">
            - Thời gian thử việc: tối đa <span id="thoi_gian_thu_viec_data"></span> với khối gián tiếp, 4 tháng với khối kinh doanh. Nhận 100% lương vị trí trong quá trình thử việc.
        </li>
    </ul>

    <h3 class="section-heading">II - THU NHẬP</h3>
    <!-- Bảng thu nhập đã được cập nhật theo yêu cầu -->
    <table class="w-full border-collapse border border-gray-400 mb-4 text-sm">
        <thead>
            <tr class="bg-gray-100 text-center font-bold">
                <th class="border border-gray-400 p-2 font-bold">Tổng thu nhập</th>
                <th class="border border-gray-400 p-2">Lương CB</th>
                <th class="border border-gray-400 p-2">Lương KPI</th>
                <th class="border border-gray-400 p-2">Đàm phán</th>
                <th class="border border-gray-400 p-2">PC chức vụ</th>
                <th class="border border-gray-400 p-2">Phụ cấp vùng miền</th>
                <th class="border border-gray-400 p-2">Phụ cấp khác</th>
                <th class="border border-gray-400 p-2">Thưởng</th>
            </tr>
        </thead>
        <tbody>
            <tr class="text-center">
                <td id="tong_thu_nhap_data" class="border border-gray-400 p-2 font-bold"></td>
                <td id="luong_cb_data" class="border border-gray-400 p-2"></td>
                <td id="luong_kpi_data" class="border border-gray-400 p-2"></td>
                <td id="dam_phan_data" class="border border-gray-400 p-2"></td>
                <td id="pc_chuc_vu_data" class="border border-gray-400 p-2"></td>
                <td id="phu_cap_vung_mien_data" class="border border-gray-400 p-2"></td>
                <td id="phu_cap_khac_data" class="border border-gray-400 p-2"></td>
                <td id="thuong_data" class="border border-gray-400 p-2"></td>
            </tr>
        </tbody>
    </table>
    
    <p class="mb-2">Trong đó:</p>
    <ul class="list-style-none indent-1">
        <li class="mb-2">
            - <span class="font-bold">Lương cơ bản</span>: Tính theo số ngày đi làm thực tế
        </li>
        <li class="mb-2">
            - <span class="font-bold">Lương KPI</span>: Tính theo tỷ lệ hoàn thành doanh số mức áp
        </li>
        <li class="mb-2">
            - <span class="font-bold">Lương đàm phán</span> (nếu có): Khoản đàm phán riêng với ứng viên, tính theo ngày đi làm
        </li>
        <li class="mb-2">
            - <span class="font-bold">Phụ cấp chức vụ</span> (nếu có): Tùy theo vị trí công việc, tính theo ngày đi làm
        </li>
        <li class="mb-2">
            - <span class="font-bold">Phụ cấp vùng miền</span> (nếu có): Công ty hỗ trợ thêm cho nhân sự làm việc tại các khu vực đặc thù, tính theo ngày đi làm
        </li>
        <li class="mb-2">
            - <span class="font-bold">Phụ cấp khác</span> (nếu có): Tùy theo vị trí công việc, tính theo ngày đi làm
        </li>
        <li class="mb-2">
            - Nhận 100% lương trong quá trình thử việc (không có thưởng)
        </li>
        <li class="mb-2">
            - <span class="font-bold">Thưởng doanh số</span>: Được nhận khi hoàn thành doanh số mức áp từ 85% trở lên. Tỷ lệ trích thưởng đạt càng lớn khi đăng ký bậc càng cao
        </li>
        <li class="mb-2">
            - Các khoản thưởng kinh doanh khác: Chiết khấu, Bán cao hơn giá niêm yết, Bán hàng tồn kho, . . . (Từ 3% đến 8% theo giá trị đơn hàng). Việc này giúp tổng thu nhập hàng tháng có thể cao hơn dự kiến như ở trên
        </li>
    </ul>

    <h3 class="section-heading">III - CHẾ ĐỘ ĐÃI NGỘ</h3>
    <ul class="list-style-none indent-1">
        <li class="mb-2">
            - Bữa trưa tại công ty. Nếu không ăn được trả phụ cấp theo khu vực (từ 700k - 1 triệu)
        </li>
        <li class="mb-2">
            - Nghỉ phép 12 ngày/1 năm. Nghỉ lễ theo quy định của nhà nước. Đóng BHXH theo quy định của nhà nước.
        </li>
        <li class="mb-2">
            - Tặng quà hoặc tiền thưởng vào ngày lễ, tết, sinh nhật, hỷ sự. Hỗ trợ ốm đau, tai nạn, tử tuất.
        </li>
        <li class="mb-2">
            - Thưởng lương tháng 13, 14 theo kết quả kinh doanh của công ty.
        </li>
        <li class="mb-2">
            - Du lịch hàng năm. Liên hoan 3 tháng/1 lần đối với cấp Trưởng nhóm trở lên.
        </li>
        <li class="mb-2">
            - <span id="ghi_chu_data"></span>
        </li>
    </ul>
    
    <h3 class="section-heading">IV - THỦ TỤC NHẬN VIỆC</h3>
    <p>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        Khi đến mang theo bộ hồ sơ bao gồm:
    </p>
    <ul class="list-style-none indent-1">
        <li>
            (1) Sơ yếu lý lịch có dấu đỏ UBND Xã / Phường,
        </li>
        <li>
            (2) Giấy khai sinh bản photo (không công chứng),
        </li>
        <li>
            (3) Sổ hộ khẩu photo không công chứng (nếu còn),
        </li>
        <li>
            (4) Giấy xác nhận dân sự dấu đỏ của công an xã/phường,
        </li>
        <li>
            (5) Căn cước công dân photo công chứng,
        </li>
        <li>
            (6) Photo công chứng bằng cấp (nếu có)
        </li>
    </ul>

    <p class="mt-4">
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        Mọi thắc mắc xin liên hệ: P.HCNS Vinachi 0976.831.226 hcns@vinachi.vn.
    </p>
    <p class="mt-4">
        Trân trọng!
    </p>
    
    <div class="flex justify-end mt-12 mr-8">
        <div class="text-center">
            <p class="font-bold">TM CÔNG TY TNHH VINACHI</p>
            <p class="font-bold mt-2">PHÒNG HCNS</p>
        </div>
    </div>

</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const params = new URLSearchParams(window.location.search);

        // Utility function to safely update text content
        function updateElementText(id, paramName, parser = (val) => decodeURIComponent(val)) {
            const element = document.getElementById(id);
            if (element && params.has(paramName)) {
                element.textContent = parser(params.get(paramName));
            }
        }

        // Parse and format dates (DD/MM/YYYY)
        function parseAndFormatDate(paramName, dayId, monthId, yearId) {
            if (params.has(paramName)) {
                const dateStr = decodeURIComponent(params.get(paramName));
                const parts = dateStr.split('/');
                if (parts.length === 3) {
                    const [day, month, year] = parts;
                    document.getElementById(dayId).textContent = day;
                    document.getElementById(monthId).textContent = month;
                    document.getElementById(yearId).textContent = year;
                }
            }
        }
        
        // Parse and format a full date/time string (HH:mm DD/MM/YYYY)
        function parseAndFormatFullDateTime(paramName) {
            if (params.has(paramName)) {
                const fullDateTimeStr = decodeURIComponent(params.get(paramName));
                const [timeStr, dateStr] = fullDateTimeStr.split(' ');
                
                // Parse time
                if (timeStr) {
                    const [hour, minute] = timeStr.split(':');
                    document.getElementById('gio_data').textContent = hour;
                    document.getElementById('phut_data').textContent = minute;
                }

                // Parse date
                if (dateStr) {
                    const [day, month, year] = dateStr.split('/');
                    document.getElementById('ngay_nhan_viec_data').textContent = day;
                    document.getElementById('thang_nhan_viec_data').textContent = month;
                    document.getElementById('nam_nhan_viec_data').textContent = year;
                }
            }
        }
        
        // --- Data Population from URL Parameters ---
        // General text fields
        updateElementText('ten_ung_vien_data', 'ten', (val) => decodeURIComponent(val).toUpperCase());
        updateElementText('dia_diem_data', 'noiNV');
        updateElementText('vi_tri_ung_tuyen_data', 'viTri');
        updateElementText('phong_ban_data', 'phong');
        updateElementText('thoi_gian_lam_viec_data', 'tgLV');
        updateElementText('ghi_chu_data', 'ghichu');
        
        // Conditional handling for "thoi gian thu viec"
        const tgTvLi = document.getElementById('tg_tv_li');
        if (params.has('tgTV')) {
            updateElementText('thoi_gian_thu_viec_data', 'tgTV');
        } else {
            tgTvLi.style.display = 'none';
        }

        // Special fields with custom logic
        parseAndFormatDate('ngayPH', 'ngay_data', 'thang_data', 'nam_data');
        parseAndFormatFullDateTime('tgNV');

        // Salary and allowance fields
        function updateCurrencyField(id, paramName) {
            updateElementText(id, paramName, (val) => {
                const num = parseFloat(val);
                return isNaN(num) ? '0' : num.toLocaleString('vi-VN');
            });
        }
        
        updateCurrencyField('luong_cb_data', 'luongCB');
        updateCurrencyField('luong_kpi_data', 'luongKPI');
        updateCurrencyField('dam_phan_data', 'luongDP');
        updateCurrencyField('pc_chuc_vu_data', 'pcCV');
        updateCurrencyField('phu_cap_vung_mien_data', 'pcVM');
        updateCurrencyField('phu_cap_khac_data', 'pcKhac');
        
        // Total Income and Bonus fields
        const tongThuNhapTu = parseFloat(params.get('thuNhapTu')) || 0;
        const tongThuNhapDen = parseFloat(params.get('thuNhapDen')) || 0;
        if (tongThuNhapTu > 0 || tongThuNhapDen > 0) {
            document.getElementById('tong_thu_nhap_data').textContent = `Từ ${tongThuNhapTu.toLocaleString('vi-VN')} đến ${tongThuNhapDen.toLocaleString('vi-VN')}`;
        } else {
            // Fallback: calculate total from other salary components
            const total = (parseFloat(params.get('luongCB')) || 0) + 
                          (parseFloat(params.get('luongKPI')) || 0) + 
                          (parseFloat(params.get('luongDP')) || 0) + 
                          (parseFloat(params.get('pcCV')) || 0) +
                          (parseFloat(params.get('pcVM')) || 0) +
                          (parseFloat(params.get('pcKhac')) || 0);
            document.getElementById('tong_thu_nhap_data').textContent = total.toLocaleString('vi-VN');
        }

        const thuongTu = parseFloat(params.get('thuongTu')) || 0;
        const thuongDen = parseFloat(params.get('thuongDen')) || 0;
        if (thuongTu > 0 || thuongDen > 0) {
            document.getElementById('thuong_data').textContent = `Từ ${thuongTu.toLocaleString('vi-VN')} đến ${thuongDen.toLocaleString('vi-VN')}`;
        } else {
            document.getElementById('thuong_data').textContent = '0';
        }
    });

    async function downloadPDF() {
        const element = document.getElementById('documentContainer');
        const canvas = await html2canvas(element, { scale: 2 });
        const imgData = canvas.toDataURL('image/jpeg', 1.0);

        const A4_WIDTH = 210; // mm
        const A4_HEIGHT = 297; // mm
        const margin = 15; // 1.5cm
        const doc = new jspdf.jsPDF('p', 'mm', 'a4');
        const imgProps = doc.getImageProperties(imgData);
        const finalImgWidth = A4_WIDTH - 2 * margin;
        const finalImgHeight = (imgProps.height * finalImgWidth) / imgProps.width;

        doc.addImage(imgData, 'JPEG', margin, (A4_HEIGHT - finalImgHeight) / 2, finalImgWidth, finalImgHeight);
        doc.save('Thu_moi_nhan_viec.pdf');
    }
</script>

</body>
</html>
